Version 4
SHEET 1 4160 1872
WIRE 320 -128 48 -128
WIRE 560 -128 320 -128
WIRE 752 -128 560 -128
WIRE 320 -96 320 -128
WIRE 560 -96 560 -128
WIRE 752 -96 752 -128
WIRE 48 -80 48 -128
WIRE 272 -16 240 -16
WIRE 512 -16 480 -16
WIRE 704 -16 672 -16
WIRE 1280 -16 1168 -16
WIRE 1408 -16 1280 -16
WIRE 1536 -16 1488 -16
WIRE 1696 -16 1616 -16
WIRE 1872 -16 1728 -16
WIRE 2064 -16 1872 -16
WIRE 320 16 320 0
WIRE 1168 16 1168 -16
WIRE 1168 16 320 16
WIRE 1280 16 1200 16
WIRE 1408 16 1280 16
WIRE 1536 16 1488 16
WIRE 1744 16 1616 16
WIRE 1872 16 1776 16
WIRE 1968 16 1872 16
WIRE 560 32 560 0
WIRE 1200 32 1200 16
WIRE 1200 32 560 32
WIRE 320 48 320 16
WIRE 560 48 560 32
WIRE 752 48 752 0
WIRE 1280 48 752 48
WIRE 1408 48 1280 48
WIRE 1536 48 1488 48
WIRE 1792 48 1616 48
WIRE 1872 48 1824 48
WIRE 48 80 48 0
WIRE 1712 80 1712 0
WIRE 1760 80 1760 32
WIRE 1808 80 1808 64
WIRE 1872 96 1872 48
WIRE 1968 96 1968 16
WIRE 2064 96 2064 -16
WIRE 272 128 240 128
WIRE 512 128 480 128
WIRE 704 128 672 128
WIRE 48 192 48 160
WIRE 320 192 320 144
WIRE 320 192 48 192
WIRE 560 192 560 144
WIRE 560 192 320 192
WIRE 752 192 752 144
WIRE 752 192 560 192
WIRE 1872 208 1872 176
WIRE 1968 208 1968 176
WIRE 1968 208 1872 208
WIRE 2064 208 2064 176
WIRE 2064 208 1968 208
WIRE 1968 224 1968 208
WIRE 64 320 48 320
WIRE 128 368 -48 368
WIRE 320 384 192 384
WIRE 128 400 96 400
WIRE 640 400 576 400
WIRE 1168 416 1120 416
WIRE 1216 416 1168 416
WIRE 1392 416 1280 416
WIRE 1680 416 1584 416
WIRE 1824 416 1744 416
WIRE 1952 416 1888 416
WIRE -48 432 -48 368
WIRE -48 432 -80 432
WIRE 64 432 64 320
WIRE 80 432 64 432
WIRE 96 432 96 400
WIRE 96 432 80 432
WIRE 640 432 576 432
WIRE 816 432 768 432
WIRE 640 464 576 464
WIRE 816 464 768 464
WIRE 2208 464 2176 464
WIRE 2320 464 2272 464
WIRE 128 480 112 480
WIRE 320 496 192 496
WIRE 640 496 576 496
WIRE 1856 496 1856 448
WIRE -48 512 -48 432
WIRE 128 512 -48 512
WIRE 2176 528 2176 464
WIRE 2176 528 2144 528
WIRE 1248 544 1248 448
WIRE 1248 544 1088 544
WIRE 1328 544 1248 544
WIRE 1680 544 1392 544
WIRE 1952 544 1952 416
WIRE 2016 544 1952 544
WIRE 128 560 -48 560
WIRE 2208 560 2144 560
WIRE 2320 560 2272 560
WIRE 320 576 192 576
WIRE 640 576 576 576
WIRE 2016 576 1952 576
WIRE 128 592 96 592
WIRE 2176 592 2144 592
WIRE 640 608 576 608
WIRE 832 608 768 608
WIRE 2016 608 1984 608
WIRE -48 624 -48 560
WIRE -48 624 -80 624
WIRE 64 624 64 432
WIRE 96 624 96 592
WIRE 96 624 64 624
WIRE 640 640 576 640
WIRE 832 640 768 640
WIRE 1248 640 1088 640
WIRE 1328 640 1248 640
WIRE 1712 640 1712 448
WIRE 1712 640 1392 640
WIRE 1984 656 1984 608
WIRE 2176 656 2176 592
WIRE 2208 656 2176 656
WIRE 2320 656 2272 656
WIRE 112 672 112 480
WIRE 128 672 112 672
WIRE 640 672 576 672
WIRE 320 688 192 688
WIRE 1680 688 1680 544
WIRE 1712 688 1680 688
WIRE -48 704 -48 624
WIRE 128 704 -48 704
WIRE 1248 720 1248 640
WIRE 1712 720 1712 688
WIRE 1856 720 1856 688
WIRE 128 752 -48 752
WIRE 1168 752 1120 752
WIRE 1216 752 1168 752
WIRE 1392 752 1280 752
WIRE 1680 752 1584 752
WIRE 1824 752 1744 752
WIRE 1952 752 1952 576
WIRE 1952 752 1888 752
WIRE 320 768 192 768
WIRE 128 784 96 784
WIRE 640 784 576 784
WIRE -48 816 -48 752
WIRE -48 816 -80 816
WIRE 64 816 64 624
WIRE 96 816 96 784
WIRE 96 816 64 816
WIRE 640 816 576 816
WIRE 848 816 752 816
WIRE 640 848 576 848
WIRE 112 864 112 672
WIRE 128 864 112 864
WIRE 320 880 192 880
WIRE -48 896 -48 816
WIRE 128 896 -48 896
WIRE 112 944 112 864
WIRE 112 944 48 944
WIRE 1408 1008 1408 976
WIRE 1504 1024 1504 976
WIRE 1408 1120 1408 1088
WIRE 1504 1136 1504 1104
FLAG 1968 224 0
FLAG 1872 -16 a
FLAG 1872 16 b
FLAG 1872 48 c
FLAG 576 400 a
FLAG 576 432 b
FLAG 576 464 c
FLAG 816 432 Vgd
FLAG 816 464 Vgq
FLAG 1712 80 Ia
FLAG 1760 80 Ib
FLAG 1808 80 Ic
FLAG 576 576 Ia
FLAG 576 608 Ib
FLAG 576 640 Ic
FLAG 832 608 id
FLAG 832 640 iq
FLAG 576 496 theta
FLAG 576 672 theta
FLAG 1088 544 id
FLAG 1088 640 iq
FLAG 1856 496 Vgd
FLAG 1856 688 Vgq
FLAG 1984 656 theta
FLAG 320 384 G1
FLAG 320 496 G2
FLAG 2320 464 Ka
FLAG 2320 560 Kb
FLAG 2320 656 Kc
FLAG -80 432 Ka
FLAG 320 576 G3
FLAG 320 688 G4
FLAG -80 624 Kb
FLAG 320 768 G5
FLAG 320 880 G6
FLAG -80 816 Kc
FLAG 576 784 a
FLAG 576 816 b
FLAG 576 848 c
FLAG 848 816 theta
FLAG 240 -16 G1
FLAG 240 128 G2
FLAG 480 -16 G3
FLAG 480 128 G4
FLAG 672 -16 G5
FLAG 672 128 G6
FLAG 1168 416 id_ref
FLAG 1168 752 iq_ref
FLAG 1408 1120 0
FLAG 1504 1136 0
FLAG 1408 976 Inv
FLAG 1504 976 Non
FLAG 1280 -16 a_inv
FLAG 1280 16 b_inv
FLAG 1280 48 c_inv
FLAG 80 432 Carrier
SYMBOL voltage 1872 80 R0
WINDOW 3 -201 109 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(0 310 50 0 0 0)
SYMATTR InstName V3
SYMBOL voltage 1968 80 R0
WINDOW 3 -82 170 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value SINE(0 310 50 0 0 120)
SYMATTR InstName V4
SYMBOL voltage 2064 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value SINE(0 310 50 0 0 240)
SYMBOL abctodq 704 448 R0
SYMATTR InstName U1
SYMBOL step 1088 416 R0
SYMATTR InstName U2
SYMATTR Value A={Id}
SYMATTR Value2 td={td} SR=1e8
SYMBOL abctodq 704 624 R0
SYMATTR InstName U3
SYMBOL isense 1712 -16 R0
SYMATTR InstName U4
SYMBOL isense 1760 16 R0
SYMATTR InstName U5
SYMBOL isense 1808 48 R0
SYMATTR InstName U6
SYMBOL sub2 1248 416 R0
SYMATTR InstName U7
SYMBOL sub2 1248 752 M180
SYMATTR InstName U8
SYMBOL step 1088 752 R0
SYMATTR InstName U9
SYMATTR Value A={Iq}
SYMATTR Value2 td={td} SR=1e8
SYMBOL Gain_1 1360 544 R0
SYMATTR InstName U10
SYMATTR Value K={wL}
SYMBOL Gain_1 1360 640 R0
SYMATTR InstName U11
SYMATTR Value K={wL}
SYMBOL PI_ctrl 1488 416 R0
SYMATTR InstName U12
SYMBOL PI_ctrl 1488 752 R0
SYMATTR InstName U13
SYMBOL sub2 1712 416 R0
SYMATTR InstName U14
SYMBOL adder2 1712 752 M180
SYMATTR InstName U15
SYMBOL adder2 1856 752 M180
SYMATTR InstName U16
SYMBOL adder2 1856 416 R0
SYMATTR InstName U17
SYMBOL dqtoabc 2080 576 R0
SYMATTR InstName U18
SYMBOL comp 160 384 R0
SYMATTR InstName U19
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL sawtooth 16 320 R0
SYMATTR InstName U21
SYMATTR Value Vlow={Vlo} Vhigh={Vhi} f={f}
SYMATTR Value2 ""
SYMATTR SpiceLine Vlow={Vlo} Vhigh={Vhi} f={f}
SYMBOL comp 160 496 R0
SYMATTR InstName U20
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL Gain_1 2240 464 R0
SYMATTR InstName U22
SYMBOL Gain_1 2240 560 R0
SYMATTR InstName U23
SYMBOL Gain_1 2240 656 R0
SYMATTR InstName U24
SYMBOL comp 160 576 R0
SYMATTR InstName U25
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL comp 160 688 R0
SYMATTR InstName U27
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL comp 160 768 R0
SYMATTR InstName U28
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL comp 160 880 R0
SYMATTR InstName U30
SYMATTR Value Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMATTR Value2 ""
SYMATTR SpiceLine Vhigh={Vhi_comp} Vlow={Vlo_comp}
SYMBOL voltage 48 -96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 200
SYMBOL voltage 48 64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 200
SYMBOL ind 1520 0 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {L}
SYMBOL ind 1520 32 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {L}
SYMBOL ind 1520 64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value {L}
SYMBOL res 1504 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1
SYMBOL res 1504 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL res 1504 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL nmos 272 -96 R0
SYMATTR InstName M1
SYMATTR Value STW11NM80
SYMBOL nmos 272 48 R0
SYMATTR InstName M2
SYMATTR Value STW11NM80
SYMBOL nmos 512 -96 R0
SYMATTR InstName M3
SYMATTR Value STW11NM80
SYMBOL nmos 512 48 R0
SYMATTR InstName M4
SYMATTR Value STW11NM80
SYMBOL nmos 704 -96 R0
SYMATTR InstName M5
SYMATTR Value STW11NM80
SYMBOL nmos 704 48 R0
SYMATTR InstName M6
SYMATTR Value STW11NM80
SYMBOL sawtooth 16 944 R0
SYMATTR InstName U32
SYMATTR Value Vlow={Vlo} Vhigh={Vhi} f={9k}
SYMATTR Value2 ""
SYMATTR SpiceLine Vlow={Vlo} Vhigh={Vhi} f={9k}
SYMBOL voltage 1504 1008 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value PULSE({Vlow} {Vhigh} 0 {0.99*1/f} {0.99*1/f} 0 {1/f})
SYMBOL voltage 1408 992 R0
WINDOW 3 -686 91 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({Vlow} {Vhigh} 100u {0.99*1/f} {0.99*1/f} 0 {1/f})
SYMATTR InstName V7
SYMBOL 3P_PLL 672 816 R0
SYMATTR InstName U26
TEXT 1888 280 Left 2 !.tran 100m
TEXT 2496 136 Left 2 !.param Vhi_comp=12 Vlo_comp=0 Vhi=12 Vlo=0 f=10k
TEXT 2496 160 Left 2 !.param Kp=10
TEXT 2496 184 Left 2 !.param Ki=0
TEXT 2496 112 Left 2 !.param td =40m
TEXT 2496 16 Left 2 !.param theta_rad = (-30*pi)/180
TEXT 2496 40 Left 2 !.param Id=Is*cos(theta_rad)
TEXT 2496 64 Left 2 !.param Iq=Is*sin(theta_rad)
TEXT 2496 88 Left 2 !.param Is=50
TEXT 2496 -8 Left 2 !.param L =0.5m
TEXT 2496 208 Left 2 !.param wL= 0.1571
TEXT 1128 1136 Left 2 !.param Vlow=0 Vhigh=12
